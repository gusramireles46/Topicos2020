<html>
<head>
<title>Buscaminas.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #0000ff;}
.s3 { color: #008000; font-weight: bold;}
.s4 { color: #808080; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Buscaminas.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span>sample.Vistas;

<span class="s0">import </span>javafx.geometry.Insets;
<span class="s0">import </span>javafx.geometry.Pos;
<span class="s0">import </span>javafx.scene.Scene;
<span class="s0">import </span>javafx.scene.control.*;
<span class="s0">import </span>javafx.scene.image.ImageView;
<span class="s0">import </span>javafx.scene.input.MouseButton;
<span class="s0">import </span>javafx.scene.input.MouseEvent;
<span class="s0">import </span>javafx.scene.layout.GridPane;
<span class="s0">import </span>javafx.scene.layout.HBox;
<span class="s0">import </span>javafx.scene.layout.VBox;
<span class="s0">import </span>javafx.stage.Stage;
<span class="s0">import </span>sample.Eventos.EventoBuscaminas;

<span class="s0">public class </span>Buscaminas <span class="s0">extends </span>Stage {
    <span class="s0">private </span>Label _lblRow, _lblCol;
    <span class="s0">private </span>TextField _txfRow, _txfCol;
    <span class="s0">private </span>Button _btnMinar, _btnReiniciar;
    <span class="s0">private </span>GridPane _gdpCampo;
    <span class="s0">private </span>ToggleButton[][] _tgbCeldas;
    <span class="s0">private </span>Scene _escena;
    <span class="s0">private </span>HBox _hbox;
    <span class="s0">private </span>VBox _vbox;
    <span class="s0">private </span>String[][] contador;
    <span class="s0">private int </span>nr = <span class="s2">0</span>;
    <span class="s0">private int </span>nc = <span class="s2">0</span>;
    <span class="s0">private boolean </span>gameOver = <span class="s0">true</span>;


    <span class="s0">public </span>Alert _objAlert = <span class="s0">new </span>Alert(Alert.AlertType.INFORMATION);

    <span class="s0">public </span>Buscaminas(){
        CrearGUI();
        <span class="s0">this</span>.setTitle(<span class="s3">&quot;Buscaminas &gt;:)&quot;</span>);
        <span class="s0">this</span>.setScene(_escena);
        <span class="s0">this</span>.show();
    }

    <span class="s0">private void </span>CrearGUI() {
        _vbox = <span class="s0">new </span>VBox();
        _hbox = <span class="s0">new </span>HBox();

        _hbox.setSpacing(<span class="s2">10</span>);
        _hbox.setAlignment(Pos.CENTER);

        _lblRow = <span class="s0">new </span>Label(<span class="s3">&quot;No. Renglones&quot;</span>);
        _lblCol = <span class="s0">new </span>Label(<span class="s3">&quot;No. Columnas&quot;</span>);
        _txfRow = <span class="s0">new </span>TextField();
        _txfRow.setMaxWidth(<span class="s2">50</span>);
        _txfCol = <span class="s0">new </span>TextField();
        _txfCol.setMaxWidth(<span class="s2">50</span>);
        _btnMinar = <span class="s0">new </span>Button(<span class="s3">&quot;Minar Campo&quot;</span>);

        _btnReiniciar = <span class="s0">new </span>Button();
        _btnReiniciar.setGraphic(<span class="s0">new </span>ImageView(<span class="s3">&quot;sample/Imagenes/actualizar.png&quot;</span>));
        _btnReiniciar.setOnAction(event -&gt; {
            close();
            <span class="s0">new </span>Buscaminas();
        });

        _btnMinar.setGraphic(<span class="s0">new </span>ImageView(<span class="s3">&quot;sample/Imagenes/bomba.png&quot;</span>));
        _btnMinar.setOnAction(event -&gt; {
            crearCampo();
            minarCampo();
        });

        <span class="s4">//_btnMinar.addEventHandler(MouseEvent.MOUSE_CLICKED, new EventoBuscaminas(_txfRow, _txfCol, _arrBtnCeldas, _gdpCampo, _vbox));</span>

        _hbox.getChildren().addAll(_lblRow, _txfRow, _lblCol, _txfCol, _btnMinar, _btnReiniciar);
        _gdpCampo = <span class="s0">new </span>GridPane();
        _vbox.getChildren().addAll(_hbox, _gdpCampo);
        _vbox.setPadding(<span class="s0">new </span>Insets(<span class="s2">10</span>));

        _escena = <span class="s0">new </span>Scene(_vbox,<span class="s2">700</span>,<span class="s2">650</span>);
        <span class="s4">//_escena.getStylesheets().add(&quot;sample/Estilos/Bootstrap3.css&quot;);</span>
    }

    <span class="s0">private void </span>crearCampo() {
        String _strR = _txfRow.getText();
        String _strC = _txfCol.getText();

        nr = Integer.parseInt(_strR);
        nc = Integer.parseInt(_strC);

        _tgbCeldas = <span class="s0">new </span>ToggleButton[nr][nc];
        contador = <span class="s0">new </span>String[nr][nc];

        <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s2">0</span>; i &lt; nr; i++) {
            <span class="s0">for </span>(<span class="s0">int </span>j = <span class="s2">0</span>; j &lt; nc; j++) {
                _tgbCeldas[i][j] = <span class="s0">new </span>ToggleButton();
                _tgbCeldas[i][j].setPrefSize(<span class="s2">35</span>,<span class="s2">35</span>);
                _tgbCeldas[i][j].setStyle(<span class="s3">&quot;-fx-base: #CCCCCC;&quot;</span>);


                <span class="s0">int </span>x = i;
                <span class="s0">int </span>y = j;

                _tgbCeldas[i][j].setOnMouseClicked(e -&gt; {
                    <span class="s0">if </span>(e.getButton() == MouseButton.PRIMARY){
                        eventoBuscaminas(x,y);
                    } <span class="s0">else if </span>(e.getButton() == MouseButton.SECONDARY){
                        <span class="s0">if </span>(e.getClickCount() == <span class="s2">1</span>)
                            isFlagged(x, y);
                        <span class="s0">else if </span>(e.getClickCount() == <span class="s2">2</span>) {
                            _tgbCeldas[x][y].setGraphic(<span class="s0">null</span>);
                            _tgbCeldas[x][y].setDisable(<span class="s0">false</span>);
                        }
                    }
                });

                _gdpCampo.add(_tgbCeldas[i][j], i, j);
                _gdpCampo.setAlignment(Pos.CENTER);
                _gdpCampo.setPadding(<span class="s0">new </span>Insets(<span class="s2">15</span>));
            }
        }
    }

    <span class="s0">private void </span>isFlagged(<span class="s0">int </span>x, <span class="s0">int </span>y) {
        _tgbCeldas[x][y].setGraphic(<span class="s0">new </span>ImageView(<span class="s3">&quot;sample/Imagenes/banderas16.png&quot;</span>));
    }

    <span class="s0">private void </span>descubrirMinas(){
        <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s2">0</span>; i &lt; nr; i++) {
            <span class="s0">for </span>(<span class="s0">int </span>j = <span class="s2">0</span>; j &lt; nc; j++) {
                <span class="s0">if </span>(contador[i][j].equals(<span class="s3">&quot;*&quot;</span>))
                    _tgbCeldas[i][j].setText(<span class="s3">&quot;*&quot;</span>);
            }
        }
    }

    <span class="s0">private void </span>eventoBuscaminas(<span class="s0">int </span>a, <span class="s0">int </span>b) {

        <span class="s0">if </span>(!gameOver){
            <span class="s0">if </span>(_tgbCeldas[a][b].isSelected()){
                <span class="s0">if </span>(contador[a][a].equals(<span class="s3">&quot;*&quot;</span>)){
                    descubrirMinas();

                    _objAlert.setTitle(<span class="s3">&quot;Mensaje del sistema&quot;</span>);
                    _objAlert.setHeaderText(<span class="s3">&quot;Perdiste :'c&quot;</span>);
                    _objAlert.setContentText(<span class="s3">&quot;Oh no, te has topado con una mina :/&quot;</span>);
                    _objAlert.showAndWait();
                    _tgbCeldas[a][b].setSelected(<span class="s0">false</span>);
                    gameOver = <span class="s0">true</span>;
                    close();
                    <span class="s0">new </span>Buscaminas();
                } <span class="s0">else </span>{
                    _tgbCeldas[a][b].setText(contador[a][b]);
                    _tgbCeldas[a][b].setSelected(<span class="s0">true</span>);
                }
            } _tgbCeldas[a][b].setSelected(<span class="s0">true</span>);

            <span class="s0">try</span>{
                <span class="s0">int </span>winner = <span class="s2">0</span>;
                <span class="s0">int </span>m = <span class="s2">0</span>;
                <span class="s0">if</span>(_tgbCeldas[a][b].isSelected()) {
                    <span class="s0">if </span>(
                            contador[a][b].equals(<span class="s3">&quot;&quot;</span>) || contador[a][b].equals(<span class="s3">&quot;1&quot;</span>) ||
                            contador[a][b].equals(<span class="s3">&quot;2&quot;</span>) || contador[a][b].equals(<span class="s3">&quot;3&quot;</span>) ||
                            contador[a][b].equals(<span class="s3">&quot;4&quot;</span>) || contador[a][b].equals(<span class="s3">&quot;5&quot;</span>) ||
                            contador[a][b].equals(<span class="s3">&quot;6&quot;</span>) || contador[a][b].equals(<span class="s3">&quot;7&quot;</span>) ||
                            contador[a][b].equals(<span class="s3">&quot;8&quot;</span>)
                    ){
                        winner++;
                    }
                    <span class="s0">if </span>(winner == m) {
                        descubrirMinas();

                        _objAlert.setTitle(<span class="s3">&quot;Mensaje del sistema&quot;</span>);
                        _objAlert.setHeaderText(<span class="s3">&quot;Ganaste&quot;</span>);
                        _objAlert.setContentText(<span class="s3">&quot;Has detectado todas las minas&quot;</span>);
                        _objAlert.showAndWait();
                        _tgbCeldas[a][b].setSelected(<span class="s0">false</span>);
                        gameOver = <span class="s0">true</span>;
                        close();
                        <span class="s0">new </span>Buscaminas();
                    }
                }
            } <span class="s0">catch </span>(Exception e){}
        }
    }

    <span class="s0">private void </span>minarCampo() {
        gameOver = <span class="s0">false</span>;
        <span class="s0">double </span>minas = (nr * nc) * (<span class="s2">0.25</span>);
        <span class="s0">int </span>intMinas = (<span class="s0">int</span>) Math.round(minas);

        <span class="s0">if </span>(intMinas &gt; <span class="s2">0</span>){
            <span class="s0">for </span>(<span class="s0">int </span>i = <span class="s2">0</span>; i &lt; intMinas; i++) {
                <span class="s0">int </span>a = <span class="s2">0</span>, b = <span class="s2">0</span>;

                a = (<span class="s0">int</span>)(Math.random()*<span class="s2">16</span>)+<span class="s2">1</span>;
                b = (<span class="s0">int</span>)(Math.random()*<span class="s2">16</span>)+<span class="s2">1</span>;

                <span class="s0">if </span>(contador[nr][nc].equals(<span class="s3">&quot;&quot;</span>))
                    contador[nr][nc] = <span class="s3">&quot;*&quot;</span>;
                <span class="s0">else</span>
                    i--;
                
            }
        }
    }
}
</pre>
</body>
</html>